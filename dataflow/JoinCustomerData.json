{
    "name": "JoinCustomerData",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "DemographicsCSV",
                        "type": "DatasetReference"
                    },
                    "name": "DemographicsData",
                    "description": "Import data from DemographicsCSV"
                },
                {
                    "dataset": {
                        "referenceName": "LocationCSV",
                        "type": "DatasetReference"
                    },
                    "name": "LocationData",
                    "description": "Import data from LocationCSV"
                },
                {
                    "dataset": {
                        "referenceName": "ServicesCSV",
                        "type": "DatasetReference"
                    },
                    "name": "ServicesData",
                    "description": "Import data from ServicesCSV"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "CustomerCSV",
                        "type": "DatasetReference"
                    },
                    "name": "CustomerDataSink"
                }
            ],
            "transformations": [
                {
                    "name": "InnerJoinWithLocationData"
                },
                {
                    "name": "InnerJoinWithServicesData"
                },
                {
                    "name": "SelectColumns"
                }
            ],
            "scriptLines": [
                "source(output(",
                "          CustomerID as string,",
                "          Gender as string,",
                "          Age as string,",
                "          Under30 as string,",
                "          SeniorCitizen as string,",
                "          Married as string,",
                "          Dependents as string,",
                "          NumberDependents as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false) ~> DemographicsData",
                "source(output(",
                "          CustomerID as string,",
                "          Country as string,",
                "          State as string,",
                "          City as string,",
                "          ZipCode as string,",
                "          Latitude as string,",
                "          Longitude as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false) ~> LocationData",
                "source(output(",
                "          CustomerID as string,",
                "          Quarter as string,",
                "          ReferredFriend as string,",
                "          NumberReferrals as string,",
                "          TenureMonths as string,",
                "          Offer as string,",
                "          PhoneService as string,",
                "          AvgMonthlyLongDistanceCharges as string,",
                "          MultipleLines as string,",
                "          InternetService as string,",
                "          InternetType as string,",
                "          AvgMonthlyGBDownload as string,",
                "          OnlineSecurity as string,",
                "          OnlineBackup as string,",
                "          DeviceProtectionPlan as string,",
                "          PremiumTechSupport as string,",
                "          StreamingTV as string,",
                "          StreamingMovies as string,",
                "          StreamingMusic as string,",
                "          UnlimitedData as string,",
                "          Contract as string,",
                "          PaperlessBilling as string,",
                "          PaymentMethod as string,",
                "          MonthlyCharge as string,",
                "          TotalCharges as string,",
                "          TotalRefunds as string,",
                "          TotalExtraDataCharges as string,",
                "          TotalLongDistanceCharges as string,",
                "          TotalRevenue as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     ignoreNoFilesFound: false) ~> ServicesData",
                "DemographicsData, LocationData join(DemographicsData@CustomerID == LocationData@CustomerID,",
                "     joinType:'inner',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> InnerJoinWithLocationData",
                "InnerJoinWithLocationData, ServicesData join(DemographicsData@CustomerID == ServicesData@CustomerID,",
                "     joinType:'inner',",
                "     matchType:'exact',",
                "     ignoreSpaces: false,",
                "     broadcast: 'auto')~> InnerJoinWithServicesData",
                "InnerJoinWithServicesData select(mapColumn(",
                "          CustomerID = DemographicsData@CustomerID,",
                "          Gender,",
                "          Age,",
                "          Under30,",
                "          SeniorCitizen,",
                "          Married,",
                "          Dependents,",
                "          NumberDependents,",
                "          Country,",
                "          State,",
                "          City,",
                "          ZipCode,",
                "          Latitude,",
                "          Longitude,",
                "          ReferredFriend,",
                "          NumberReferrals,",
                "          TenureMonths,",
                "          Offer,",
                "          PhoneService,",
                "          AvgMonthlyLongDistanceCharges,",
                "          MultipleLines,",
                "          InternetService,",
                "          InternetType,",
                "          AvgMonthlyGBDownload,",
                "          OnlineSecurity,",
                "          OnlineBackup,",
                "          DeviceProtectionPlan,",
                "          PremiumTechSupport,",
                "          StreamingTV,",
                "          StreamingMovies,",
                "          StreamingMusic,",
                "          UnlimitedData,",
                "          Contract,",
                "          PaperlessBilling,",
                "          PaymentMethod,",
                "          MonthlyCharge,",
                "          TotalCharges,",
                "          TotalRefunds,",
                "          TotalExtraDataCharges,",
                "          TotalLongDistanceCharges,",
                "          TotalRevenue",
                "     ),",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true) ~> SelectColumns",
                "SelectColumns sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     input(",
                "          CustomerID as string,",
                "          Gender as string,",
                "          Age as string,",
                "          Under30 as string,",
                "          SeniorCitizen as string,",
                "          Married as string,",
                "          Dependents as string,",
                "          NumberDependents as string,",
                "          Country as string,",
                "          State as string,",
                "          City as string,",
                "          ZipCode as string,",
                "          Latitude as string,",
                "          Longitude as string,",
                "          ReferredFriend as string,",
                "          NumberReferrals as string,",
                "          TenureMonths as string,",
                "          Offer as string,",
                "          PhoneService as string,",
                "          AvgMonthlyLongDistanceCharges as string,",
                "          MultipleLines as string,",
                "          InternetService as string,",
                "          InternetType as string,",
                "          AvgMonthlyGBDownload as string,",
                "          OnlineSecurity as string,",
                "          OnlineBackup as string,",
                "          DeviceProtectionPlan as string,",
                "          PremiumTechSupport as string,",
                "          StreamingTV as string,",
                "          StreamingMovies as string,",
                "          StreamingMusic as string,",
                "          UnlimitedData as string,",
                "          Contract as string,",
                "          PaperlessBilling as string,",
                "          PaymentMethod as string,",
                "          MonthlyCharge as string,",
                "          TotalCharges as string,",
                "          TotalRefunds as string,",
                "          TotalExtraDataCharges as string,",
                "          TotalLongDistanceCharges as string,",
                "          TotalRevenue as string",
                "     ),",
                "     partitionFileNames:['customer.csv'],",
                "     umask: 0022,",
                "     preCommands: [],",
                "     postCommands: [],",
                "     skipDuplicateMapInputs: true,",
                "     skipDuplicateMapOutputs: true,",
                "     partitionBy('hash', 1)) ~> CustomerDataSink"
            ]
        }
    }
}